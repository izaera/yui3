YUI.add("editor-base",function(g,e){var t=g.Lang,u=function(){u.superclass.constructor.apply(this,arguments)},s=":last-child";g.extend(u,g.Base,{frame:null,initializer:function(){this.publish("nodeChange",{emitFacade:!0,bubbles:!0,defaultFn:this._defNodeChangeFn})},destructor:function(){this.detachAll()},copyStyles:function(t,e){var n;t.test("a")||(n={},g.each(["color","fontSize","fontFamily","backgroundColor","fontStyle"],function(e){n[e]=t.getStyle(e)}),t.ancestor("b,strong")&&(n.fontWeight="bold"),t.ancestor("u")&&!n.textDecoration&&(n.textDecoration="underline"),e.setStyles(n))},_lastBookmark:null,_resolveChangedNode:function(e){var t,n,o,a,r=this.getInstance(),i=this._getRoot();if(e&&e.compareTo(i)&&(a=new r.EditorSelection)&&a.anchorNode&&(e=a.anchorNode),r&&e&&e.test("html")){for(t=i.one(s);!o;)t&&(n=t.one(s))?t=n:o=!0;(t=t&&(t.test("br")?t.previous()?t.previous():t.get("parentNode"):t))&&(e=t)}return e=e||i},_getRoot:function(){return this.getInstance().EditorSelection.ROOT},_defNodeChangeFn:function(e){(new Date).getTime();var a,r,t,i=this.getInstance(),s={},c=[],d="",h="",l=!1,n=this._getRoot();if(g.UA.ie&&g.UA.ie<11)try{(t=i.config.doc.selection.createRange()).getBookmark&&(this._lastBookmark=t.getBookmark())}catch(o){}e.changedNode=this._resolveChangedNode(e.changedNode),"tab"!==e.changedType||e.changedNode.test("li, li *")||e.changedEvent.shiftKey||(e.changedEvent.frameEvent.preventDefault(),g.UA.webkit?this.execCommand("inserttext","\t"):g.UA.gecko?this.frame.exec._command("inserthtml",u.TABKEY):g.UA.ie&&this.execCommand("inserthtml",u.TABKEY)),g.UA.webkit&&e.commands&&(e.commands.indent||e.commands.outdent)&&(t=n.all(".webkit-indent-blockquote, blockquote")).size()&&t.setStyle("margin",""),n=this.getDomPath(e.changedNode,!1),e.commands&&(s=e.commands),g.each(n,function(e){var t,n,o=e.tagName.toLowerCase(),o=u.TAG2CMD[o];o&&(s[o]=1),""+(o=e.currentStyle||e.style).fontWeight=="normal"&&(l=!0),""+o.fontWeight=="bold"&&(s.bold=1),g.UA.ie&&400<o.fontWeight&&(s.bold=1),"italic"===o.fontStyle&&(s.italic=1),-1<o.textDecoration.indexOf("underline")&&(s.underline=1),-1<o.textDecoration.indexOf("line-through")&&(s.strikethrough=1),(t=i.one(e)).getStyle("fontFamily")&&(n=t.getStyle("fontFamily").split(",")[0].toLowerCase(),a=(a=n?n:a)&&a.replace(/'/g,"").replace(/"/g,"")),r=u.NORMALIZE_FONTSIZE(t),n=e.className.split(" "),g.each(n,function(e){""!==e&&"yui_"!==e.substr(0,4)&&c.push(e)}),d=u.FILTER_RGB(t.getStyle("color")),"transparent"!==(e=u.FILTER_RGB(o.backgroundColor))&&""!==e&&(h=e)}),l&&(delete s.bold,delete s.italic),e.dompath=i.all(n),e.classNames=c,e.commands=s,e.fontFamily||(e.fontFamily=a),e.fontSize||(e.fontSize=r),e.fontColor||(e.fontColor=d),e.backgroundColor||(e.backgroundColor=h),(new Date).getTime()},getDomPath:function(e,t){for(var n=[],o=this._getRoot(),a=this.frame.getInstance(),r=a.Node.getDOMNode(e),i=a.Node.getDOMNode(o);null!==r;){if(r===a.config.doc.documentElement||r===a.config.doc||!r.tagName){r=null;break}if(!a.DOM.inDoc(r)){r=null;break}if(r.nodeName&&r.nodeType&&1===r.nodeType&&n.push(r),r===i){r=null;break}r=r.parentNode}return 0===n.length&&(n[0]=a.config.doc.body),t?a.all(n.reverse()):n.reverse()},_afterFrameReady:function(){var e=this.frame.getInstance();this.frame.on("dom:mouseup",g.bind(this._onFrameMouseUp,this)),this.frame.on("dom:mousedown",g.bind(this._onFrameMouseDown,this)),this.frame.on("dom:keydown",g.bind(this._onFrameKeyDown,this)),g.UA.ie&&g.UA.ie<11&&(this.frame.on("dom:activate",g.bind(this._onFrameActivate,this)),this.frame.on("dom:beforedeactivate",g.bind(this._beforeFrameDeactivate,this))),this.frame.on("dom:keyup",g.bind(this._onFrameKeyUp,this)),this.frame.on("dom:keypress",g.bind(this._onFrameKeyPress,this)),this.frame.on("dom:paste",g.bind(this._onPaste,this)),e.EditorSelection.filter(),this.fire("ready")},_beforeFrameDeactivate:function(e){e.frameTarget.test("html")||(e=this.getInstance().config.doc.selection.createRange()).compareEndPoints&&!e.compareEndPoints("StartToEnd",e)&&e.pasteHTML('<var id="yui-ie-cursor">')},_onFrameActivate:function(t){var n,e;t.frameTarget.test("html")||(n=(new(this.getInstance().EditorSelection)).createRange(),(e=this._getRoot().all("#yui-ie-cursor")).size()&&e.each(function(e){if(e.set("id",""),n.moveToElementText)try{n.moveToElementText(e._node),-1===n.move("character",-1)&&n.move("character",1),n.select(),n.text=""}catch(t){}e.remove()}))},_onPaste:function(e){this.fire("nodeChange",{changedNode:e.frameTarget,changedType:"paste",changedEvent:e.frameEvent})},_onFrameMouseUp:function(e){this.fire("nodeChange",{changedNode:e.frameTarget,changedType:"mouseup",changedEvent:e.frameEvent})},_onFrameMouseDown:function(e){this.fire("nodeChange",{changedNode:e.frameTarget,changedType:"mousedown",changedEvent:e.frameEvent})},_currentSelection:null,_currentSelectionTimer:null,_currentSelectionClear:null,_onFrameKeyDown:function(e){var t;this._currentSelection?t=this._currentSelection:(this._currentSelectionTimer&&this._currentSelectionTimer.cancel(),this._currentSelectionTimer=g.later(850,this,function(){this._currentSelectionClear=!0}),t=new(this.frame.getInstance().EditorSelection)(e),this._currentSelection=t),t=new(this.frame.getInstance().EditorSelection),(this._currentSelection=t)&&t.anchorNode&&(this.fire("nodeChange",{changedNode:t.anchorNode,changedType:"keydown",changedEvent:e.frameEvent}),u.NC_KEYS[e.keyCode]&&(this.fire("nodeChange",{changedNode:t.anchorNode,changedType:u.NC_KEYS[e.keyCode],changedEvent:e.frameEvent}),this.fire("nodeChange",{changedNode:t.anchorNode,changedType:u.NC_KEYS[e.keyCode]+"-down",changedEvent:e.frameEvent})))},_onFrameKeyPress:function(e){var t=this._currentSelection;t&&t.anchorNode&&(this.fire("nodeChange",{changedNode:t.anchorNode,changedType:"keypress",changedEvent:e.frameEvent}),u.NC_KEYS[e.keyCode]&&this.fire("nodeChange",{changedNode:t.anchorNode,changedType:u.NC_KEYS[e.keyCode]+"-press",changedEvent:e.frameEvent}))},_onFrameKeyUp:function(e){var t=new(
this.frame.getInstance().EditorSelection)(e);t&&t.anchorNode&&(this.fire("nodeChange",{changedNode:t.anchorNode,changedType:"keyup",selection:t,changedEvent:e.frameEvent}),u.NC_KEYS[e.keyCode]&&this.fire("nodeChange",{changedNode:t.anchorNode,changedType:u.NC_KEYS[e.keyCode]+"-up",selection:t,changedEvent:e.frameEvent})),this._currentSelectionClear&&(this._currentSelectionClear=this._currentSelection=null)},_validateLinkedCSS:function(e){return t.isString(e)||t.isArray(e)},execCommand:function(e,t){var n=this.frame.execCommand(e,t),o={},a={changedNode:(new(this.frame.getInstance().EditorSelection)).anchorNode,changedType:"execcommand",nodes:n};switch(e){case"forecolor":a.fontColor=t;break;case"backcolor":a.backgroundColor=t;break;case"fontsize":a.fontSize=t;break;case"fontname":a.fontFamily=t}return o[e]=1,a.commands=o,this.fire("nodeChange",a),n},getInstance:function(){return this.frame.getInstance()},render:function(e){var t=this.frame;return t||(this.plug(g.Plugin.Frame,{designMode:!0,title:u.STRINGS.title,use:u.USE,dir:this.get("dir"),extracss:this.get("extracss"),linkedcss:this.get("linkedcss"),defaultblock:this.get("defaultblock")}),t=this.frame),t.hasPlugin("exec")||t.plug(g.Plugin.ExecCommand),t.after("ready",g.bind(this._afterFrameReady,this)),t.addTarget(this),t.set("content",this.get("content")),t.render(e),this},focus:function(e){return this.frame.focus(e),this},show:function(){return this.frame.show(),this},hide:function(){return this.frame.hide(),this},getContent:function(){var e="",t=this.getInstance();return e=(e=t&&t.EditorSelection?t.EditorSelection.unfilter():e).replace(/ _yuid="([^>]*)"/g,"")}},{NORMALIZE_FONTSIZE:function(e){var t=e.getStyle("fontSize"),n=t;switch(t){case"-webkit-xxx-large":t="48px";break;case"xx-large":t="32px";break;case"x-large":t="24px";break;case"large":t="18px";break;case"medium":t="16px";break;case"small":t="13px";break;case"x-small":t="10px"}return n!==t&&e.setStyle("fontSize",t),t},TABKEY:'<span class="tab">&nbsp;&nbsp;&nbsp;&nbsp;</span>',FILTER_RGB:function(e){var t,n,o;return-1!==e.toLowerCase().indexOf("rgb")&&(o=new RegExp("(.*?)rgb\\s*?\\(\\s*?([0-9]+).*?,\\s*?([0-9]+).*?,\\s*?([0-9]+).*?\\)(.*?)","gi"),5===(o=e.replace(o,"$1,$2,$3,$4,$5").split(",")).length&&(t=parseInt(o[1],10).toString(16),n=parseInt(o[2],10).toString(16),o=parseInt(o[3],10).toString(16),e="#"+(1===t.length?"0"+t:t)+(1===n.length?"0"+n:n)+(1===o.length?"0"+o:o))),e},TAG2CMD:{b:"bold",strong:"bold",i:"italic",em:"italic",u:"underline",sup:"superscript",sub:"subscript",img:"insertimage",a:"createlink",ul:"insertunorderedlist",ol:"insertorderedlist"},NC_KEYS:{8:"backspace",9:"tab",13:"enter",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete"},USE:["node","selector-css3","editor-selection","stylesheet"],NAME:"editorBase",STRINGS:{title:"Rich Text Editor"},ATTRS:{content:{validator:t.isString,value:'<br class="yui-cursor">',setter:function(e){return" "===(e=""===(e="\n"===e.substr(0,1)?e.substr(1):e)?'<br class="yui-cursor">':e)&&g.UA.gecko&&(e='<br class="yui-cursor">'),this.frame.set("content",e)},getter:function(){return this.frame.get("content")}},dir:{validator:t.isString,writeOnce:!0,value:"ltr"},linkedcss:{validator:"_validateLinkedCSS",value:"",setter:function(e){return this.frame&&this.frame.set("linkedcss",e),e}},extracss:{validator:t.isString,value:"",setter:function(e){return this.frame&&this.frame.set("extracss",e),e}},defaultblock:{validator:t.isString,value:"p"}}}),g.EditorBase=u},"@VERSION@",{requires:["base","frame","node","exec-command","editor-selection"]});